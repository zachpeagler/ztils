ylab("PhiPS2")+
xlab("Days From Germination")+
theme_bw()+
ylim(0.6,0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
predict_groupR(d24_ps2_mod2, d24_ps2_joined, daysfromgermination, phips2,
treatment, 100, correction = "logit", pallt = a_palette)+
ylab("Photosystem II Efficiency (PhiPS2)")+
xlab("Days From Germination")+
theme_bw()+
ylim(0.6,0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
# fruit
## mass
d24_mass_mod <- lm(log(mass) ~ treatment + daysfromgermination, data=d24_f)
summary(d24_mass_mod)
confint(d24_mass_mod)
AIC(d24_mass_mod)
comps <- glht(d24_mass_mod, linfct=mcp(treatment="Tukey"))
cld(comps)
predict_groupR(d24_mass_mod, d24_f, daysfromgermination, mass,
treatment, 100, correction = "exponential", pallt = a_palette)+
ylab("Mass (g)")+
xlab("Days From Germination")+
theme_bw()+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
## sugar
d24_sugar_mod2 <- lm(log(sugar_avg)~treatment + daysfromgermination,
data=na.omit(d24_f))
summary(d24_sugar_mod2)
AIC(d24_sugar_mod2)
confint(d24_sugar_mod2)
comps <- glht(d24_sugar_mod2, linfct=mcp(treatment="Tukey"))
cld(comps)
predict_groupR(d24_sugar_mod2, na.omit(d24_f), daysfromgermination, sugar_avg,
treatment, 100, interval = "confidence", correction = "exponential", pallt = a_palette)+
ylab("Sugar (%)")+
xlab("Days From Germination")+
theme_bw()+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
# fluorescence
## gsw
d24_gsw_mod <- glm(gsw~treatment + daysfromgermination,
data = filter(d24_li, gsw>0), family = Gamma(link="log"))
summary(d24_gsw_mod)
glm_pseudoR2(d24_gsw_mod)
d24_gsw_mod2 <- glm(gsw~treatment + rh_s,
data = filter(d24_li, gsw>0), family = Gamma(link="log"))
summary(d24_gsw_mod2)
glm_pseudoR2(d24_gsw_mod2)
comps <- glht(d24_gsw_mod2, linfct=mcp(treatment="Tukey"))
cld(comps)
predict_groupR(d24_gsw_mod2, dat = filter(d24_li, gsw>0), rh_s, gsw,
treatment, 100, pallt = a_palette)+
ylab("Stomatal Conductance")+
xlab("Relative Humidity (%)")+
theme_bw()+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
## phips2
d24_ps2_mod <- lmer(logit(phips2) ~ treatment + daysfromgermination + (1 | Device),
data = d24_ps2_joined)
summary(d24_ps2_mod)
AIC(d24_ps2_mod)
r.squaredGLMM(d24_ps2_mod)
comps <- glht(d24_ps2_mod, linfct=mcp(treatment="Tukey"))
cld(comps)
### box plot of logit PhiPS2 by treatment with annotations
ggplot(data = d24_ps2_joined, aes(x= treatment, y = phips2,
fill=treatment, color=treatment, shape = Device)) +
geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
geom_jitter( width=.15, height=0)+
scale_fill_manual(values=four_colors)+
scale_color_manual(values=four_colors)+
ylim(0.55, 0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
annotate("text", x=1:4, y=.8, label = c("a", "b", "a", "b"), size=10, family="open")+
labs(
title="PhiPS2 by Inoculation Treatment and Device in Tomato Plant"
) +
ylab("PhiPS2")+
xlab("Treatment")+
theme_bw()+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold")
)
### a worse model, but decent for visualizing the predictions
d24_ps2_mod2 <- lm(logit(phips2) ~ treatment + daysfromgermination,
data = d24_ps2_joined)
predict_groupR(d24_ps2_mod2, d24_ps2_joined, daysfromgermination, phips2,
treatment, 100, correction = "logit", pallt = a_palette)+
ylab("Photosystem II Efficiency (PhiPS2)")+
xlab("Days From Germination")+
theme_bw()+
ylim(0.6,0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
predict_groupR(d24_ps2_mod2, d24_ps2_joined, daysfromgermination, phips2,
treatment, 100, correction = "logit", pallt = a_palette)+
ylab("Photosystem II Efficiency (PhiPS2)")+
xlab("Days From Germination")+
theme_bw()+
ylim(0.55,0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
# fruit
## mass
d24_mass_mod <- lm(log(mass) ~ treatment + daysfromgermination, data=d24_f)
summary(d24_mass_mod)
confint(d24_mass_mod)
AIC(d24_mass_mod)
comps <- glht(d24_mass_mod, linfct=mcp(treatment="Tukey"))
cld(comps)
predict_groupR(d24_mass_mod, d24_f, daysfromgermination, mass,
treatment, 100, correction = "exponential", pallt = a_palette)+
ylab("Mass (g)")+
xlab("Days From Germination")+
theme_bw()+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
## sugar
d24_sugar_mod2 <- lm(log(sugar_avg)~treatment + daysfromgermination,
data=na.omit(d24_f))
summary(d24_sugar_mod2)
AIC(d24_sugar_mod2)
confint(d24_sugar_mod2)
comps <- glht(d24_sugar_mod2, linfct=mcp(treatment="Tukey"))
cld(comps)
predict_groupR(d24_sugar_mod2, na.omit(d24_f), daysfromgermination, sugar_avg,
treatment, 100, interval = "confidence", correction = "exponential", pallt = a_palette)+
ylab("Sugar (%)")+
xlab("Days From Germination")+
theme_bw()+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
# fluorescence
## gsw
d24_gsw_mod <- glm(gsw~treatment + daysfromgermination,
data = filter(d24_li, gsw>0), family = Gamma(link="log"))
summary(d24_gsw_mod)
glm_pseudoR2(d24_gsw_mod)
d24_gsw_mod2 <- glm(gsw~treatment + rh_s,
data = filter(d24_li, gsw>0), family = Gamma(link="log"))
summary(d24_gsw_mod2)
glm_pseudoR2(d24_gsw_mod2)
comps <- glht(d24_gsw_mod2, linfct=mcp(treatment="Tukey"))
cld(comps)
predict_groupR(d24_gsw_mod2, dat = filter(d24_li, gsw>0), rh_s, gsw,
treatment, 100, pallt = a_palette)+
ylab("Stomatal Conductance")+
xlab("Relative Humidity (%)")+
theme_bw()+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
## phips2
d24_ps2_mod <- lmer(logit(phips2) ~ treatment + daysfromgermination + (1 | Device),
data = d24_ps2_joined)
summary(d24_ps2_mod)
AIC(d24_ps2_mod)
r.squaredGLMM(d24_ps2_mod)
comps <- glht(d24_ps2_mod, linfct=mcp(treatment="Tukey"))
cld(comps)
### box plot of logit PhiPS2 by treatment with annotations
ggplot(data = d24_ps2_joined, aes(x= treatment, y = phips2,
fill=treatment, color=treatment, shape = Device)) +
geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
geom_jitter( width=.15, height=0)+
scale_fill_manual(values=four_colors)+
scale_color_manual(values=four_colors)+
ylim(0.55, 0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
annotate("text", x=1:4, y=.8, label = c("a", "b", "a", "b"), size=10, family="open")+
labs(
title="PhiPS2 by Inoculation Treatment and Device in Tomato Plant"
) +
ylab("PhiPS2")+
xlab("Treatment")+
theme_bw()+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold")
)
### a worse model, but decent for visualizing the predictions
d24_ps2_mod2 <- lm(logit(phips2) ~ treatment + daysfromgermination,
data = d24_ps2_joined)
predict_groupR(d24_ps2_mod2, d24_ps2_joined, daysfromgermination, phips2,
treatment, 100, correction = "logit", pallt = a_palette)+
ylab("Photosystem II Efficiency (PhiPS2)")+
xlab("Days From Germination")+
theme_bw()+
ylim(0.55,0.8)+
guides(
fill = guide_legend(title="Treatment"),
color= guide_legend(title="Treatment"))+
theme(
text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
title = element_text(size=title_size, family="open", face="bold"),
plot.subtitle = element_text(size=subtitle_size, face="italic"))
# fruit
## ber
d24_ber_mod <- lm(fber ~ treatment, data=d24_f)
summary(d24_ber_mod)
# fruit
## ber
d24_ber_mod <- lm(ber ~ treatment, data=d24_f)
summary(d24_ber_mod)
# fruit
## ber
d24_ber_mod <- lm(logit(pber) ~ treatment, data=d24_f_summary)
summary(d24_ber_mod)
ggplot()+geom_point(data=d24_f_summary, aes(x=treatment, y=pber))
ggplot()+geom_boxplot(data=d24_f_summary, aes(x=treatment, y=pber))
# fruit
## ber
d24_ber_mod <- lm(logit(pber) ~ treatment, data=d24_f_summary)
summary(d24_ber_mod)
# fruit
## ber
d24_ber_mod <- lm(pber) ~ treatment, data=d24_f_summary)
# fruit
## ber
d24_ber_mod <- lm(pber ~ treatment, data=d24_f_summary)
summary(d24_ber_mod)
## model is not significant
d24_mass_mod2 <- lm(log(mass_mean) ~ treatment, data = d24_f_means)
summary(d24_mass_mod2)
## mass
d24_mass_mod <- lm(log(mass) ~ treatment + daysfromgermination, data=d24_f)
summary(d24_mass_mod)
confint(d24_mass_mod)
AIC(d24_mass_mod)
comps <- glht(d24_mass_mod, linfct=mcp(treatment="Tukey"))
cld(comps)
# get packages
require(plotly); require(tidyverse); require(lme4); require(showtext); require(scico); require(pwr); require(car); require(ggpubr); require(rstatix); require(MASS); require(devtools); require(multcomp); require(lmerTest); require(MuMIn)
# custom package
install_github("zachpeagler/ztils")
require(ztils)
a_palette <- "oslo"
# super lazy way to make palettes
two_colors = scico(2, begin = 0.9, end=0.1, palette=a_palette)
four_colors = scico(4, begin = 0.9, end=0.1, palette=a_palette)
five_colors = scico(5, begin = 0.9, end=0.1, palette=a_palette)
ten_col = scico(10, begin = 0.9, end=0.1, palette=a_palette)
twelve_col = scico(12, begin = 0.9, end=0.1, palette=a_palette)
# add fonts
font_add_google("Open Sans", family = "open")
font_add_google("Montserrat", family = "mont")
# initialize imported fonts
showtext_auto()
# font sizes
## title
title_size = 24
## subtitle
subtitle_size = 20
## caption
caption_size = 16
## text
text_size = 16
# custom shapes
four_shapes = c(15,16,17,23)
## germination date
germdate23 <- "2023-04-14"
germdate24 <- "2024-05-01"
## cutoff time
## necessary due to some early morning/late night measurements
### 2022
cutoff22 <- "12:00:00"
## treatment orders
treatment_order21 <- c("Control",
"Salt Stress",
"Inoculation",
"Salt+Inoc")
treatment_order22 <- c("Control",
"Salt Stress",
"Inoculation",
"Salt+Inoc")
treatment_order23 <- c("Control",
"Soil",
"Foliar",
"Soil+Foliar")
treatment_order24 <- c("Control",
"Transplantation",
"Germination",
"Germ+Trans")
## plant factor order
### do we even need this?
### p
plant_order24 <- c("A1", "A2", "A3", "A4", "A5", "A6",
"A7", "A8", "A9", "A10", "A11", "A12",
"B1", "B2", "B3", "B4", "B5", "B6",
"B7", "B8", "B9", "B10", "B11", "B12",
"C1", "C2", "C3", "C4", "C5", "C6",
"C7", "C8", "C9", "C10", "C11", "C12",
"D1", "D2", "D3", "D4", "D5", "D6",
"D7", "D8", "D9", "D10", "D11", "D12")
# 2021
d21_f_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2021/TIP21_Fruit.csv"
d21_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2021/TIP21_Multispeq.csv"
# 2022
d22_f_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2022/TIP22_Fruit.csv"
d22_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2022/TIP22_Multispeq.csv"
# 2023
d23_fg_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_Fruit_Greenhouse.csv"
d23_fl_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_Fruit_Lab.csv"
d23_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_Multispeq.csv"
d23_li_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_LI600.csv"
d23_st_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_StomatalDensity.csv"
# 2024
d24_f_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2024/TIP24_Fruit.csv"
d24_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2024/TIP24_Multispeq.csv"
d24_li_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2024/TIP24_LI600.csv"
# 2021
## fruit
d21_f <- read.csv(d21_f_file) %>% mutate(
Salt = case_when(
Salt=="N"~"FALSE",
Salt=="Y"~"TRUE"
),
Salt = as.logical(Salt),
Inoculated = case_when(
Inoculated =="N"~"FALSE",
Inoculated =="Y"~"TRUE"
),
Inoculated = as.logical(Inoculated),
BER = case_when(
BER=="N"~"FALSE",
BER=="Y"~"TRUE"
),
BER = as.logical(BER)
)
a_temp <- data.frame(a=character(0))
b_temp <- data.frame(b=numeric(0))
for (x in seq_len(nrow(d21_f))) {
a = strsplit(d21_f$Pot, split="")[[x]][1]
b = strsplit(d21_f$Pot, split="")[[x]][2]
a_temp <- rbind(a_temp, a)
b_temp <- rbind(b_temp, b)
}
d21_f$Row <- a_temp$X.A.
d21_f$Plant <- as.factor(d21_f$Pot)
d21_f$Pot <- b_temp$X.1.
d21_f$Pot <- as.factor(d21_f$Pot)
d21_f <- d21_f %>%
mutate(
Row_num = case_when(
Row=="A"~ 1,
Row=="B"~ 2,
Row=="C"~ 3,
Row=="D"~ 4,
TRUE~NA),
treatment = case_when(
Salt == TRUE & Inoculated == TRUE ~ "Salt+Inoc",
Salt == TRUE & Inoculated == FALSE ~ "Salt Stress",
Salt == FALSE & Inoculated == TRUE ~ "Inoculation",
Salt == FALSE & Inoculated == FALSE ~ "Control",
TRUE~NA),
treatment = factor(treatment, levels = treatment_order21)
)
d21_f$Row <- as.factor(d21_f$Row)
colnames(d21_f) <- tolower(colnames(d21_f))
d21_f <- d21_f %>%
rename(mass = fruitweight) %>%
mutate(fruitnumber = 1)
### Make summary dataframe with mean and sd of mass and sugar by plant.
d21_f_means <- d21_f %>%
group_by(treatment, plant) %>%
summarise_at(vars(mass), list(mean=mean, sd=sd))
### Sum the fruit, BER, and mass by treatment group, then get ber probability.
d21_f_summary <- d21_f %>%
group_by(treatment) %>%
summarise_at(vars(fruitnumber, mass, ber),
list(sum=sum)) %>%
mutate(pber = round(ber_sum/fruitnumber_sum, 4))
### Sum the fruit, BER, and mass by treatment group, then get ber probability.
#### by plant
d21_f_summary_byplant <- d21_f %>%
group_by(treatment, plant) %>%
summarise_at(vars(fruitnumber, mass, ber),
list(sum=sum)) %>%
mutate(pber = round(ber_sum/fruitnumber_sum, 4))
## multispeq
d21_m <- read.csv(d21_m_file)[,c(1,6,7,8,10,11,12,21,27,34,35,41,53,59)] %>%
rename(Pot = Pot.ID) %>%
mutate(
Row_num = case_when(
Row=="A"~ 1,
Row=="B"~ 2,
Row=="C"~ 3,
Row=="D"~ 4,
TRUE~NA),
Plant = as.factor(paste0(Row, Pot)),
Treatment = case_when(
Plant %in% c("A1", "A3", "A5", "B2", "B4", "B6") ~ "Control",
Plant %in% c("A2", "A4", "A6", "B1", "B3", "B5", "B7") ~ "Salt Stress",
Plant %in% c("C1", "C3", "C5", "D2", "D4", "D6") ~ "Inoculation",
Plant %in% c("C2", "C4", "C6", "C7","D1", "D3", "D5", "D7") ~ "Salt+Inoc"
),
salt = case_when(
Treatment=="Control"~FALSE,
Treatment=="Salt Stress"~TRUE,
Treatment=="Inoculation"~FALSE,
Treatment=="Salt+Inoc"~TRUE
),
inoculation = case_when(
Treatment=="Control"~FALSE,
Treatment=="Salt Stress"~FALSE,
Treatment=="Inoculation"~TRUE,
Treatment=="Salt+Inoc"~TRUE
),
Treatment = factor(Treatment, levels = treatment_order21),
Pot = as.factor(Pot),
Row = as.factor(Row),
Device.ID = as.factor(Device.ID),
Leaf.position = as.factor(Leaf.position),
Date = as.Date(time, "%m/%d/%Y"),
Time = parse_date_time(time, "%m/%d/%Y %H:%M %p"),
Time = format(Time, "%H:%M:%S"),
logitPS2 = logit(Phi2, FALSE),
logitFvPFmP = logit(FvP_over_FmP, FALSE)
)
# fruit
## mass
### PDF, CDF, and KS test
multiPDF_Z(d21_f$mass, 100, "all", a_palette, "mass")+
labs(tag="2021")
ggsave("21mass_PDF.svg", path = "C:/Github/Thesis/figures/TIP21")
colnames(d21_f$mass)
colnames(d21_f)
colnames("d21_f$mass")
strsplit(d21_f$mass, split="$")
strsplit(deparse(d21_f$mass), split="$")
strsplit(deparse(substitute(d21_f$mass)), split="$")
strsplit(deparse(substitute(d21_f$mass)), split="[$]")
strsplit(deparse(substitute(d21_f$mass)), split="[$]")[2]
strsplit(deparse(substitute(d21_f$mass)), split="[$]")
unlist(strsplit(deparse(substitute(d21_f$mass)), split="[$]"))
unlist(strsplit(deparse(substitute(d21_f$mass)), split="[$]"))[2]
setwd("C:/Github/ztils")
devtools::document()
